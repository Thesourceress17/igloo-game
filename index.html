<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¦×‘×™× ××ª ×”××™×’×œ×•</title>
    
    <!-- ×˜×¢×™× ×ª ×¡×¤×¨×™×•×ª ×•×¤×•× ×˜×™× -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    
    <style>
        body { 
            overscroll-behavior: none; 
            font-family: 'Varela Round', sans-serif;
        }
        /* ×˜×¨×™×§ ×œ××™×–×•×’ ×ª××•× ×•×ª ×¢× ×¨×§×¢ ×œ×‘×Ÿ ×œ×ª×•×š ×”×©×œ×’ */
        .blend-snow {
            mix-blend-mode: multiply;
        }
    </style>
</head>
<body class="bg-slate-100">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        // ×”×’×“×¨×ª ×§×‘×¦×™×
        const BACKGROUND_IMAGE = 'bg.jpg'; 

        const FURNITURE = [
          { id: 'fur-bed',       label: '××™×˜×ª ×¤×¨×•×•×”',   src: 'fur-bed.png',       width: 25 },
          { id: 'coffee-table',  label: '×©×•×œ×—×Ÿ ×§×¤×”',    src: 'coffee-table.png',  width: 18 },
          { id: 'walking-steps', label: '××“×¨×’×•×ª',       src: 'walking-steps.png', width: 25 },
          { id: 'shelf_crate',   label: '××“×£ ×•××¨×’×–',    src: 'shelf_crate.png',   width: 20 },
          { id: 'ice_bar',       label: '×‘×¨ ×§×¨×—',       src: 'ice-bar.png',       width: 28 },
          { id: 'fire-place',    label: '××— ××—××',      src: 'fire-place.jpg',    width: 15 },
          { id: 'wooden_table',  label: '×©×•×œ×—×Ÿ ×¢×¥',     src: 'wooden_table.png',  width: 22 },
          { id: 'innuits',       label: '××¡×§×™××•×¡×™×',    src: 'innuits.jpg',       width: 20 },
        ];

        function App() {
          const [items, setItems] = useState([]);
          const [dragInfo, setDragInfo] = useState(null);
          const [blendMode, setBlendMode] = useState(true); // ××¦×‘ ×©×™×œ×•×‘ ××•×¤×¢×œ ×›×‘×¨×™×¨×ª ××—×“×œ
          const containerRef = useRef(null);

          // ×”×•×¡×¤×ª ×¤×¨×™×˜
          const addItem = (itemDef) => {
            setItems(prev => [...prev, {
              uid: Date.now() + Math.random(),
              ...itemDef,
              x: 50, y: 50, rotation: 0
            }]);
          };

          // × ×™×”×•×œ ×’×¨×™×¨×”
          const handleDragStart = (e, uid) => {
            e.stopPropagation();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            setDragInfo({ uid, startX: clientX, startY: clientY });
          };

          const handleDragMove = (e) => {
            if (!dragInfo || !containerRef.current) return;
            e.preventDefault();
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const rect = containerRef.current.getBoundingClientRect();

            const x = ((clientX - rect.left) / rect.width) * 100;
            const y = ((clientY - rect.top) / rect.height) * 100;

            setItems(prev => prev.map(item => 
              item.uid === dragInfo.uid 
                ? { ...item, x: Math.max(0, Math.min(100, x)), y: Math.max(0, Math.min(100, y)) } 
                : item
            ));
          };

          const handleDragEnd = () => setDragInfo(null);

          const handleDoubleClick = (uid) => {
            setItems(prev => prev.map(item => 
              item.uid === uid ? { ...item, rotation: (item.rotation + 45) % 360 } : item
            ));
          };

          return (
            <div 
              className="flex flex-col h-screen overflow-hidden select-none touch-none bg-slate-50"
              onPointerMove={handleDragMove}
              onPointerUp={handleDragEnd}
              onPointerLeave={handleDragEnd}
              onTouchMove={handleDragMove}
              onTouchEnd={handleDragEnd}
            >
              {/* ×›×•×ª×¨×ª ××¢×•×¦×‘×ª */}
              <header className="bg-white/80 backdrop-blur-md p-3 shadow-sm z-20 flex justify-between px-6 items-center border-b border-slate-200">
                <div className="flex items-center gap-2">
                    <span className="text-2xl">â„ï¸</span>
                    <h1 className="font-bold text-slate-700 text-xl tracking-tight">×¢×™×¦×•×‘ ×”××™×’×œ×•</h1>
                </div>
                
                <div className="flex gap-3">
                    {/* ×›×¤×ª×•×¨ ×”×—×œ×¤×ª ××¦×‘ ×©×™×œ×•×‘ */}
                    <button 
                      onClick={() => setBlendMode(!blendMode)}
                      className={`text-xs px-3 py-1.5 rounded-full transition font-bold border flex items-center gap-1 ${blendMode ? 'bg-blue-100 text-blue-700 border-blue-200' : 'bg-slate-100 text-slate-500 border-slate-200'}`}
                      title="××¡×ª×™×¨ ×¨×§×¢ ×œ×‘×Ÿ ×©×œ ×ª××•× ×•×ª"
                    >
                      {blendMode ? 'âœ¨ ××™×–×•×’ ×©×œ×’ ×¤×¢×™×œ' : 'ğŸŒ‘ ××¦×‘ ×¨×’×™×œ'}
                    </button>

                    <button 
                      onClick={() => setItems([])}
                      className="text-xs text-red-600 bg-red-50 hover:bg-red-100 px-3 py-1.5 rounded-full transition font-bold border border-red-200 flex items-center gap-1"
                    >
                      ğŸ—‘ï¸ × ×§×” ×”×›×œ
                    </button>
                </div>
              </header>

              <div className="flex flex-1 overflow-hidden">
                {/* ×¡×¨×’×œ ×¦×“ ××¢×•×¦×‘ */}
                <aside className="w-32 bg-white border-l border-slate-100 p-2 flex flex-col gap-3 overflow-y-auto z-10 shadow-xl">
                  <div className="text-center text-xs text-slate-400 font-bold mt-2 mb-1">×‘×—×¨×• ×¨×”×™×˜×™×</div>
                  {FURNITURE.map(item => (
                    <button
                      key={item.id}
                      onClick={() => addItem(item)}
                      className="relative p-2 rounded-xl bg-slate-50 border border-slate-100 hover:border-blue-300 hover:bg-blue-50 hover:shadow-md transition-all group flex flex-col items-center"
                    >
                      <img 
                        src={item.src} 
                        alt={item.label}
                        className={`w-full h-16 object-contain pointer-events-none transition-transform group-hover:scale-105 ${blendMode ? 'blend-snow' : ''}`}
                        onError={(e) => {
                          e.target.style.display = 'none';
                          e.target.nextSibling.style.display = 'flex';
                        }}
                      />
                      {/* Fallback */}
                      <div className="hidden w-full h-16 items-center justify-center bg-slate-100 text-[9px] text-red-400 text-center p-1 leading-tight rounded">
                        ×©×’×™××” ×‘×˜×¢×™× ×”<br/>{item.src}
                      </div>
                      <span className="text-[11px] text-slate-600 mt-2 text-center font-bold leading-tight w-full">
                        {item.label}
                      </span>
                    </button>
                  ))}
                </aside>

                {/* ××©×˜×— ×¢×‘×•×“×” */}
                <main className="flex-1 bg-slate-200/50 flex items-center justify-center p-2 md:p-6 relative">
                  <div 
                    ref={containerRef}
                    className="relative w-full max-w-6xl aspect-video bg-white shadow-2xl overflow-hidden rounded-2xl border-4 border-white ring-1 ring-slate-200"
                  >
                    {/* ×ª××•× ×ª ×¨×§×¢ */}
                    <img 
                      src={BACKGROUND_IMAGE}
                      className="w-full h-full object-cover pointer-events-none"
                      alt="Background"
                      onError={(e) => {
                          e.target.style.display = 'none';
                          e.target.parentElement.classList.add('bg-slate-300');
                      }}
                    />
                    
                    {/* ×¤×¨×™×˜×™× */}
                    {items.map(item => (
                      <div
                        key={item.uid}
                        onPointerDown={(e) => handleDragStart(e, item.uid)}
                        onDoubleClick={() => handleDoubleClick(item.uid)}
                        className="absolute flex flex-col items-center group cursor-move touch-none"
                        style={{
                          left: `${item.x}%`,
                          top: `${item.y}%`,
                          width: `${item.width}%`,
                          transform: `translate(-50%, -50%) rotate(${item.rotation}deg)`,
                          zIndex: dragInfo?.uid === item.uid ? 50 : 10
                        }}
                      >
                        {/* ×›×¤×ª×•×¨ ××—×™×§×” */}
                        <button 
                          onPointerDown={(e) => { e.stopPropagation(); setItems(prev => prev.filter(i => i.uid !== item.uid)); }}
                          className="absolute -top-3 -right-3 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition shadow-lg z-50 hover:scale-110 font-bold text-[10px] border border-white"
                        >
                          âœ•
                        </button>

                        <img 
                          src={item.src} 
                          alt={item.label}
                          draggable={false}
                          /* ×”×•×¡×¤× ×• ×›××Ÿ ××ª ×”-blend-snow ×›×“×™ ×œ××–×’ ××ª ×”×œ×‘×Ÿ */
                          className={`w-full h-auto select-none transition-all ${blendMode ? 'blend-snow opacity-90' : 'drop-shadow-xl'}`}
                          onError={(e) => {
                             e.target.style.display = 'none';
                             e.target.nextSibling.style.display = 'flex';
                          }}
                        />
                        
                        {/* Fallback ×œ×¤×¨×™×˜ ×¢×œ ×”××¡×š */}
                        <div className="hidden w-20 h-20 bg-white/60 border-2 border-dashed border-red-300 rounded-lg flex-col items-center justify-center text-center p-1 backdrop-blur-sm shadow-sm">
                           <span className="text-xl">âš ï¸</span>
                           <span className="text-[10px] font-bold text-slate-700 mt-1">{item.label}</span>
                        </div>
                      </div>
                    ))}
                  </div>
                </main>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
